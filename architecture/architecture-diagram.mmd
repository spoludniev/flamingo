graph TB
    subgraph "AWS Organization"
        subgraph "Production Account"
            subgraph "VPC: company-prod-vpc"
                subgraph "Public Subnets"
                    LB[Application Load Balancer<br/>ALB]
                    NAT[NAT Gateway]
                end
                
                subgraph "Private Subnets - AZ1"
                    EKS1[EKS Node Group 1<br/>t3.large/m5.xlarge]
                    subgraph "EKS Cluster"
                        subgraph "Backend Namespace"
                            BE1[Flask Backend Pods<br/>HPA: 3-50 replicas]
                        end
                        subgraph "Frontend Namespace"
                            FE1[React Frontend Pods<br/>HPA: 3-20 replicas]
                        end
                    end
                end
                
                subgraph "Private Subnets - AZ2"
                    EKS2[EKS Node Group 2<br/>t3.large/m5.xlarge]
                    BE2[Flask Backend Pods]
                    FE2[React Frontend Pods]
                end
                
                subgraph "Database Subnets"
                    DB_PEER[VPC Peering]
                end
            end
        end
        
        subgraph "Staging Account"
            STG_VPC[Staging VPC]
            STG_EKS[Staging EKS]
        end
        
        subgraph "Development Account"
            DEV_VPC[Dev VPC]
            DEV_EKS[Dev EKS]
        end
    end
    
    subgraph "MongoDB Atlas on AWS"
        subgraph "Primary Region: us-east-1"
            MONGO_PRI[MongoDB Primary<br/>M10 Cluster]
            MONGO_SEC1[MongoDB Secondary 1]
            MONGO_SEC2[MongoDB Secondary 2]
        end
        subgraph "Secondary Region: us-west-2"
            MONGO_DR[MongoDB DR Replica]
        end
    end
    
    subgraph "AWS Services"
        GITHUB[GitHub<br/>Source Code]
        CODEBUILD[CodeBuild/CodePipeline<br/>CI/CD Pipeline]
        ECR[Elastic Container Registry<br/>ECR]
        SECRETS[AWS Secrets Manager]
        MONITORING[CloudWatch Logs<br/>Prometheus/Grafana]
        S3[S3<br/>Backups & Artifacts]
    end
    
    subgraph "Users"
        USERS[End Users]
        DEVS[Developers]
    end
    
    %% Connections
    USERS -->|HTTPS| LB
    LB -->|Internal| BE1
    LB -->|Internal| BE2
    BE1 -->|Serve| FE1
    BE2 -->|Serve| FE2
    BE1 -->|Read/Write| DB_PEER
    BE2 -->|Read/Write| DB_PEER
    DB_PEER -->|VPC Peering| MONGO_PRI
    MONGO_PRI -->|Replication| MONGO_SEC1
    MONGO_PRI -->|Replication| MONGO_SEC2
    MONGO_PRI -->|Backup| MONGO_DR
    MONGO_DR -->|S3 Replication| S3
    
    DEVS -->|Push Code| GITHUB
    GITHUB -->|Trigger| CODEBUILD
    CODEBUILD -->|Build & Push| ECR
    ECR -->|Deploy| EKS1
    ECR -->|Deploy| EKS2
    
    BE1 -->|Read Secrets| SECRETS
    BE2 -->|Read Secrets| SECRETS
    BE1 -->|Logs & Metrics| MONITORING
    BE2 -->|Logs & Metrics| MONITORING
    
    EKS1 -->|Auto-scale| EKS2
    EKS2 -->|Auto-scale| EKS1
    
    style LB fill:#FF9900
    style MONGO_PRI fill:#13a52c
    style EKS1 fill:#232F3E
    style EKS2 fill:#232F3E
    style CODEBUILD fill:#FF9900
    style SECRETS fill:#232F3E
    style S3 fill:#569A31

